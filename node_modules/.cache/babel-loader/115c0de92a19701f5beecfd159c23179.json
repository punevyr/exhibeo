{"ast":null,"code":"import _toConsumableArray from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _classCallCheck from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/charlie/code/ex/exhiibeo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport axios from 'axios';\nimport { keys } from '../utils/utils';\nvar CLIENT_API_R0 = '/_matrix/client/r0';\n/**\n * Handling the HTTP connection to the matrix synapse node\n */\n\nexport var MatrixHttpClient = /*#__PURE__*/function () {\n  function MatrixHttpClient(baseUrl) {\n    _classCallCheck(this, MatrixHttpClient);\n\n    this.baseUrl = baseUrl;\n    this.cancelTokenSource = axios.CancelToken.source();\n  }\n  /**\n   * Get data from the synapse node\n   *\n   * @param endpoint\n   * @param options\n   */\n\n\n  _createClass(MatrixHttpClient, [{\n    key: \"get\",\n    value: function get(endpoint, params, options) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", this.send('GET', endpoint, options, params));\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n    }\n    /**\n     * Post data to the synapse node\n     *\n     * @param endpoint\n     * @param body\n     * @param options\n     * @param params\n     */\n\n  }, {\n    key: \"post\",\n    value: function post(endpoint, body, options, params) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", this.send('POST', endpoint, options, params, body));\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    }\n    /**\n     * Put data to the synapse node\n     *\n     * @param endpoint\n     * @param body\n     * @param options\n     * @param params\n     */\n\n  }, {\n    key: \"put\",\n    value: function put(endpoint, body, options, params) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", this.send('PUT', endpoint, options, params, body));\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    }\n  }, {\n    key: \"cancelAllRequests\",\n    value: function cancelAllRequests() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                return _context4.abrupt(\"return\", this.cancelTokenSource.cancel('Manually cancelled'));\n\n              case 1:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n    }\n    /**\n     * Send a request to the synapse node\n     *\n     * @param method\n     * @param endpoint\n     * @param config\n     * @param requestParams\n     * @param data\n     */\n\n  }, {\n    key: \"send\",\n    value: function send(method, endpoint, config, requestParams, data) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var headers, params, response;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                headers = config ? this.getHeaders(config) : undefined;\n                params = requestParams ? this.getParams(requestParams) : undefined;\n                _context5.prev = 2;\n                _context5.next = 5;\n                return axios.request({\n                  method: method,\n                  url: endpoint,\n                  baseURL: this.apiUrl(CLIENT_API_R0),\n                  headers: headers,\n                  data: data,\n                  params: params,\n                  cancelToken: this.cancelTokenSource.token\n                });\n\n              case 5:\n                response = _context5.sent;\n                _context5.next = 11;\n                break;\n\n              case 8:\n                _context5.prev = 8;\n                _context5.t0 = _context5[\"catch\"](2);\n                throw _context5.t0.response.data;\n\n              case 11:\n                return _context5.abrupt(\"return\", response.data);\n\n              case 12:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[2, 8]]);\n      }));\n    }\n    /**\n     * Get the headers based on the options object\n     *\n     * @param options\n     */\n\n  }, {\n    key: \"getHeaders\",\n    value: function getHeaders(options) {\n      var headers = {};\n      var entries = [];\n\n      if (options.accessToken) {\n        entries.push(['Authorization', \"Bearer \".concat(options.accessToken)]);\n      }\n\n      if (entries.length === 0) {\n        return undefined;\n      }\n\n      for (var _i = 0, _entries = entries; _i < _entries.length; _i++) {\n        var _entries$_i = _slicedToArray(_entries[_i], 2),\n            key = _entries$_i[0],\n            value = _entries$_i[1];\n\n        headers[key] = value;\n      }\n\n      return headers;\n    }\n    /**\n     * Get parameters\n     *\n     * @param _params\n     */\n\n  }, {\n    key: \"getParams\",\n    value: function getParams(_params) {\n      if (!_params) {\n        return undefined;\n      }\n\n      var params = Object.assign(_params, {});\n      keys(params).forEach(function (key) {\n        return params[key] === undefined && delete params[key];\n      });\n      return params;\n    }\n    /**\n     * Construct API URL\n     */\n\n  }, {\n    key: \"apiUrl\",\n    value: function apiUrl() {\n      var apiBase = this.baseUrl.endsWith('/') ? this.baseUrl.substr(0, this.baseUrl.length - 1) : this.baseUrl;\n\n      for (var _len = arguments.length, parts = new Array(_len), _key = 0; _key < _len; _key++) {\n        parts[_key] = arguments[_key];\n      }\n\n      var apiParts = parts.map(function (path) {\n        return path.startsWith('/') ? path.substr(1) : path;\n      });\n      return [apiBase].concat(_toConsumableArray(apiParts)).join('/');\n    }\n  }]);\n\n  return MatrixHttpClient;\n}();","map":{"version":3,"sources":["../../../src/matrix-client/MatrixHttpClient.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport axios from 'axios';\nimport { keys } from '../utils/utils';\nconst CLIENT_API_R0 = '/_matrix/client/r0';\n/**\n * Handling the HTTP connection to the matrix synapse node\n */\nexport class MatrixHttpClient {\n    constructor(baseUrl) {\n        this.baseUrl = baseUrl;\n        this.cancelTokenSource = axios.CancelToken.source();\n    }\n    /**\n     * Get data from the synapse node\n     *\n     * @param endpoint\n     * @param options\n     */\n    get(endpoint, params, options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.send('GET', endpoint, options, params);\n        });\n    }\n    /**\n     * Post data to the synapse node\n     *\n     * @param endpoint\n     * @param body\n     * @param options\n     * @param params\n     */\n    post(endpoint, body, options, params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.send('POST', endpoint, options, params, body);\n        });\n    }\n    /**\n     * Put data to the synapse node\n     *\n     * @param endpoint\n     * @param body\n     * @param options\n     * @param params\n     */\n    put(endpoint, body, options, params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.send('PUT', endpoint, options, params, body);\n        });\n    }\n    cancelAllRequests() {\n        return __awaiter(this, void 0, void 0, function* () {\n            return this.cancelTokenSource.cancel('Manually cancelled');\n        });\n    }\n    /**\n     * Send a request to the synapse node\n     *\n     * @param method\n     * @param endpoint\n     * @param config\n     * @param requestParams\n     * @param data\n     */\n    send(method, endpoint, config, requestParams, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const headers = config ? this.getHeaders(config) : undefined;\n            const params = requestParams ? this.getParams(requestParams) : undefined;\n            let response;\n            try {\n                response = yield axios.request({\n                    method,\n                    url: endpoint,\n                    baseURL: this.apiUrl(CLIENT_API_R0),\n                    headers,\n                    data,\n                    params,\n                    cancelToken: this.cancelTokenSource.token\n                });\n            }\n            catch (axiosError) {\n                throw axiosError.response.data;\n            }\n            return response.data;\n        });\n    }\n    /**\n     * Get the headers based on the options object\n     *\n     * @param options\n     */\n    getHeaders(options) {\n        const headers = {};\n        const entries = [];\n        if (options.accessToken) {\n            entries.push(['Authorization', `Bearer ${options.accessToken}`]);\n        }\n        if (entries.length === 0) {\n            return undefined;\n        }\n        for (const [key, value] of entries) {\n            headers[key] = value;\n        }\n        return headers;\n    }\n    /**\n     * Get parameters\n     *\n     * @param _params\n     */\n    getParams(_params) {\n        if (!_params) {\n            return undefined;\n        }\n        const params = Object.assign(_params, {});\n        keys(params).forEach((key) => params[key] === undefined && delete params[key]);\n        return params;\n    }\n    /**\n     * Construct API URL\n     */\n    apiUrl(...parts) {\n        const apiBase = this.baseUrl.endsWith('/')\n            ? this.baseUrl.substr(0, this.baseUrl.length - 1)\n            : this.baseUrl;\n        const apiParts = parts.map((path) => (path.startsWith('/') ? path.substr(1) : path));\n        return [apiBase, ...apiParts].join('/');\n    }\n}\n//# sourceMappingURL=MatrixHttpClient.js.map"]},"metadata":{},"sourceType":"module"}